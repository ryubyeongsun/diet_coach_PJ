<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.dietcoach.project.mapper.WeightRecordMapper">

    <insert id="insertWeightRecord" parameterType="com.dietcoach.project.domain.WeightRecord"
            useGeneratedKeys="true" keyProperty="id">
        INSERT INTO weight_records (user_id, record_date, weight, memo, created_at, updated_at)
        VALUES (#{userId}, #{recordDate}, #{weight}, #{memo}, NOW(), NOW())
    </insert>

    <update id="updateWeightRecord" parameterType="com.dietcoach.project.domain.WeightRecord">
        UPDATE weight_records
        SET weight = #{weight},
            memo = #{memo},
            updated_at = NOW()
        WHERE id = #{id}
    </update>

    <select id="findByUserIdAndDate" resultType="com.dietcoach.project.domain.WeightRecord">
        SELECT id, user_id AS userId, record_date AS recordDate, weight, memo, created_at AS createdAt, updated_at AS updatedAt
        FROM weight_records
        WHERE user_id = #{userId}
          AND record_date = #{recordDate}
    </select>

    <select id="findByUserIdBetweenDates" resultType="com.dietcoach.project.domain.WeightRecord">
        SELECT id, user_id AS userId, record_date AS recordDate, weight, memo, created_at AS createdAt, updated_at AS updatedAt
        FROM weight_records
        WHERE user_id = #{userId}
          AND record_date BETWEEN #{from} AND #{to}
        ORDER BY record_date DESC
    </select>

    <select id="findLatestByUserId" resultType="com.dietcoach.project.domain.WeightRecord">
        SELECT id, user_id AS userId, record_date AS recordDate, weight, memo, created_at AS createdAt, updated_at AS updatedAt
        FROM weight_records
        WHERE user_id = #{userId}
        ORDER BY record_date DESC
        LIMIT 1
    </select>

    <select id="findByUserIdAndDateOnOrBefore" resultType="com.dietcoach.project.domain.WeightRecord">
        SELECT id, user_id AS userId, record_date AS recordDate, weight, memo, created_at AS createdAt, updated_at AS updatedAt
        FROM weight_records
        WHERE user_id = #{userId}
          AND record_date &lt;= #{recordDate}
        ORDER BY record_date DESC
        LIMIT 1
    </select>

</mapper>
