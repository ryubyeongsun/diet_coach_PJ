<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.dietcoach.project.mapper.UserMapper">

    <resultMap id="UserResultMap" type="com.dietcoach.project.domain.User">
        <id     property="id"              column="id"/>
        <result property="email"           column="email"/>
        <result property="password"        column="password"/>
        <result property="name"            column="name"/>

        <result property="gender"          column="gender"
                javaType="com.dietcoach.project.domain.Gender"/>
        <result property="birthDate"       column="birth_date"/>

        <result property="height"          column="height"/>
        <result property="weight"          column="weight"/>

        <result property="activityLevel"   column="activity_level"
                javaType="com.dietcoach.project.domain.ActivityLevel"/>
        <result property="goalType"        column="goal_type"
                javaType="com.dietcoach.project.domain.GoalType"/>

        <result property="bmr"             column="bmr"/>
        <result property="tdee"            column="tdee"/>
        <result property="targetCalories"  column="target_calories"/>

        <result property="createdAt"       column="created_at"/>
        <result property="updatedAt"       column="updated_at"/>
    </resultMap>

    <!-- 회원 저장 -->
    <insert id="insertUser" parameterType="com.dietcoach.project.domain.User"
            useGeneratedKeys="true" keyProperty="id">
        INSERT INTO users (
            email, password, name,
            gender, birth_date,
            height, weight,
            activity_level, goal_type,
            bmr, tdee, target_calories,
            created_at, updated_at
        )
        VALUES (
            #{email}, #{password}, #{name},
            #{gender}, #{birthDate},
            #{height}, #{weight},
            #{activityLevel}, #{goalType},
            #{bmr}, #{tdee}, #{targetCalories},
            NOW(), NOW()
        )
    </insert>

    <!-- id로 조회 -->
    <select id="findById" parameterType="long"
            resultMap="UserResultMap">
        SELECT *
        FROM users
        WHERE id = #{id}
    </select>

    <!-- ⭐ 이메일로 조회 -->
    <select id="findByEmail" parameterType="string"
            resultMap="UserResultMap">
        SELECT *
        FROM users
        WHERE email = #{email}
    </select>

    <update id="updateUserProfile" parameterType="com.dietcoach.project.domain.User">
        UPDATE users
        SET
            gender = #{gender},
            birth_date = #{birthDate},
            height = #{height},
            weight = #{weight},
            activity_level = #{activityLevel},
            goal_type = #{goalType},
            bmr = #{bmr},
            tdee = #{tdee},
            target_calories = #{targetCalories},
            updated_at = NOW()
        WHERE id = #{id}
    </update>

	<update id="updateUserEnergy" parameterType="com.dietcoach.project.domain.User">
    UPDATE users
    SET
        bmr = #{bmr},
        tdee = #{tdee},
        target_calories = #{targetCalories},
        updated_at = NOW()
    WHERE id = #{id}
</update>

</mapper>
